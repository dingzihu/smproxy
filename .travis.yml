language: php

php:
- 7.0
- 7.1
- 7.2

services:
- docker

before_install:
- docker pull registry.cn-hangzhou.aliyuncs.com/louislivi/swoole:smproxy
- docker run -d -p 127.0.0.1:80:4567 carlad/sinatra /bin/sh -c "cd /root/sinatra; bundle exec foreman start;"
  docker run -ti -v ./:/var/www -d -p 3366:3366 --name smproxy registry.cn-hangzhou.aliyuncs.com/louislivi/swoole:smproxy /usr/sbin/init
- docker ps -a

script:
- smproxy exec php /var/www/smproxy/bin/server start